# Фаза 4: Інструменти для анотацій та професійної документації

**Загальна мета:** Реалізувати повний функціонал для створення та управління анотаціями, включаючи текстові та розмірні стилі, а також інструменти для нанесення лінійних та паралельних розмірів. Це перетворить додаток на професійний інструмент для створення технічної документації.

**Архітектурні вимоги:**
- [x] **Централізовані стилі:** Увесь функціонал має бути інтегрований з сервісом `StyleManager`. Він стане єдиним джерелом правди для всіх стилів (текстових та розмірних).
- [x] **Командний підхід:** Нові інструменти (`DIMLINEAR`, `DIMALIGNED`) мають бути реалізовані як повноцінні команди (`Command`) з використанням `XState` для управління багатоетапною взаємодією з користувачем.
- [x] **UI/UX:** Нові вікна-менеджери стилів мають бути реалізовані як компоненти `WindowComponent`, що управляються через `WindowManager`, забезпечуючи консистентний досвід (перетягування, закриття, активація).
- [x] **Інтернаціоналізація (i18n):** Усі нові текстові елементи в UI (назви кнопок, заголовки вікон, підказки) повинні використовувати ключі з файлів локалізації.
- [x] **Серіалізація:** Усі нові об'єкти та стилі повинні підтримувати `toJSON()` та `fromJSON()` для коректного збереження та завантаження проєктів. Не забудь оновити `objectFactory`.

---

## Детальний план реалізації

### Частина 1: Фундамент - Система стилів

1.  **Розширити `StyleManager`:**
    - [x] Додати логіку для управління розмірними стилями (`DimensionStyle`) аналогічно до текстових: `addDimensionStyle`, `deleteDimensionStyle`, `updateDimensionStyle`, `setCurrentDimensionStyle` і т.д.
    - [x] Створити та зареєструвати стандартний розмірний стиль з назвою "Standard".

2.  **Створити клас `DimensionStyle` (`src/styles/dimension-style.ts`):**
    - [x] Клас повинен містити такі властивості:
        - **Лінії:** `lineColor`, `lineWidth`, `extLineColor`, `extLineWidth`, `extLineOffset`, `extLineExtend`.
        - **Символи та стрілки:** `arrowType` (enum: `ARROW`, `TICK`, `DOT`), `arrowSize`.
        - **Текст:** `textStyleName` (string, посилання на `TextStyle`), `textColor`, `textHeight`, `textOffset`.
        - **Одиниці:** `unitPrecision` (кількість знаків після коми).

3.  **Створити вікно "Менеджер розмірних стилів":**
    - [x] Створити новий контролер `DimensionStyleManagerController` (`src/dimension-style-manager-controller.ts`).
    - [x] Додати відповідне вікно у `window-container.html` з ID `dimension-style-manager-window`.
    - [x] UI має бути схожим на менеджер текстових стилів: список стилів зліва, кнопки керування ("Зробити поточним", "Новий...", "Видалити"), властивості стилю справа, згруповані за категоріями ("Лінії", "Символи та стрілки", "Текст", "Одиниці").
    - [x] Додати кнопку на `primary-toolbar.html` для виклику цього вікна.

### Частина 2: Інструменти нанесення розмірів

1.  **Створити базовий клас `DimensionObject` (`src/scene/dimension-object.ts`):**
    - [x] Це має бути абстрактний клас, що наслідує `SceneObject`.
    - [x] Властивості: `id`, `styleName`, `defPoint1`, `defPoint2` (точки, до яких прив'язується розмір), `dimLinePoint` (точка, що визначає положення розмірної лінії), `textOverride` (опціональний текст замість виміряного значення).
    - [x] Реалізувати загальні методи: `move`, `rotate`, `scale`, `getGrips` і т.д.
    - [x] Реалізувати захищений метод `drawArrow()` для малювання стрілок згідно зі стилем.

2.  **Створити клас `LinearDimensionObject` (`src/scene/linear-dimension-object.ts`):**
    - [x] Наслідує `DimensionObject`.
    - [x] Додати властивість `isVertical` (boolean).
    - [x] Реалізувати метод `draw`, який малює горизонтальний або вертикальний розмір залежно від `isVertical`. Логіка повинна враховувати всі параметри зі `DimensionStyle` (кольори, відступи, розмір стрілок, позицію тексту).

3.  **Створити клас `AlignedDimensionObject` (`src/scene/aligned-dimension-object.ts`):**
    - [x] Наслідує `DimensionObject`.
    - [x] Реалізувати метод `draw`, який малює розмір паралельно до лінії між `defPoint1` та `defPoint2`. Для цього можна використовувати `ctx.rotate()` для спрощення розрахунків.

4.  **Створити команду `DimlinearCommand` (`src/commands/dimlinear-command.ts`):**
    - [x] Використовувати `XState` для трьохетапного процесу:
        1.  Очікування першої точки (`promptingFirstPoint`).
        2.  Очікування другої точки (`promptingSecondPoint`), показувати гумову лінію.
        3.  Очікування положення розмірної лінії (`promptingDimLine`), показувати повний попередній перегляд розміру.
    - [x] Команда має визначати, створювати горизонтальний чи вертикальний розмір, на основі відносної позиції перших двох точок.

5.  **Створити команду `DimalignedCommand` (`src/commands/dimaligned-command.ts`):**
    - [x] Аналогічно до `DimlinearCommand`, але завжди створює `AlignedDimensionObject`.

### Частина 3: Оновлення інтерфейсу та інфраструктури

1.  **Створити панель інструментів "Анотації":**
    - [x] Додати `annotations-toolbar.html` у `panels`.
    - [x] Додати кнопки для `DIMLINEAR` та `DIMALIGNED` з відповідними іконками.
    - [x] Додати кнопку-перемикач для цієї панелі на `primary-toolbar`.
2.  **Оновити `objectFactory`:**
    - [x] Додати нові типи об'єктів (`linearDimension`, `alignedDimension`).
3.  **Оновити `CommandManager`:**
    - [x] Зареєструвати нові команди `DIMLINEAR` (`DLI`) та `DIMALIGNED` (`DAL`).
4.  **Оновити локалізацію:**
    - [x] Додати всі нові ключі для UI в `uk.json` та `en.json`.
5.  **Оновити `PropertiesPanel`:**
    - [x] Додати підтримку відображення та редагування властивостей для нових об'єктів-розмірів (напр., `textOverride`, вибір стилю).