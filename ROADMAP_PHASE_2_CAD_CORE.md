# Фаза 2: Професійні інструменти модифікації та інтерактивності (AutoCAD Core)

**Мета:** Реалізувати надійний, професійний CAD-двигун для модифікації геометрії та закласти фундамент для по-справжньому інтерактивної роботи через командний рядок, використовуючи перевірені промислові бібліотеки.

**Технологічний стек фази:**
- **`JSTS (JavaScript Topology Suite)`:** Для всіх складних операцій обчислювальної геометрії. Це промисловий стандарт, що гарантує точність та надійність.
- **`XState`:** Для управління станами складних, багатоетапних команд. Це дозволить нам створювати чисту, декларативну та передбачувану логіку взаємодії з користувачем.

## 2.1. Фундамент для інтерактивності

- [x] **Розширення `CommandManager` на основі `XState`:**
    - Перепроектувати `CommandManager` для управління життєвим циклом команд як формальними скінченними автоматами (state machines).
    - Кожна команда (`Trim`, `Fillet` тощо) буде реалізована як окрема машина станів в `XState`, що описує всі етапи: "очікування вибору об'єктів", "очікування вводу радіуса", "завершення".

- [x] **Інтерактивність командного рядка:**
    - Інтегрувати командний рядок з `CommandManager` для відображення запитів від поточного стану активної команди (наприклад, *“TRIM: Виберіть ріжучі кромки...”*).
    - Дозволити введення числових значень та опцій безпосередньо в командний рядок.

- [x] **Покращення системи виділення:**
    - Реалізувати підтримку двох парадигм виділення:
        - **"Noun-verb":** Спочатку виділити об'єкти, потім активувати команду. `CommandManager` передасть виділені об'єкти безпосередньо в команду.
        - **"Verb-noun":** Спочатку активувати команду, яка через `XState` перейде у стан "очікування вибору об'єктів".

## 2.2. Реалізація інструментів модифікації на базі JSTS

- [x] **Фундаментальна інтеграція `JSTS`:** Створити сервіс-обгортку над `JSTS`, що буде надавати уніфіковані методи для операцій перетину, об'єднання, різниці та побудови буферів для всіх типів об'єктів у нашій сцені.

- [x] **"Обрізати" (`Trim`) та "Подовжити" (`Extend`):**
    - **Ключові технічні завдання:** Використовувати `JSTS` для точного знаходження точок перетину між геометріями. Реалізувати логіку, яка на основі цих точок та вибору користувача коректно модифікує (обрізає або розширює) вихідні об'єкти.

- [x] **"Зміщення" (`Offset`):**
    - **Ключові технічні завдання:** Використати функціонал побудови буферних зон (`buffer`) з `JSTS` для створення паралельних копій ліній, поліліній та дуг.

- [x] **"Дзеркало" (`Mirror`):**
    - **Ключові технічні завдання:** Реалізувати математичне віддзеркалення, використовуючи власну логіку, оскільки це афінне перетворення, що не вимагає `JSTS`.

- [x] **"Скруглення" (`Fillet`) та "Фаска" (`Chamfer`):**
    - **Ключові технічні завдання:** Розробити алгоритм, який використовує `JSTS` для знаходження точки перетину, після чого математично розраховує точки обрізки та створює новий об'єкт (`ArcObject` для Fillet або сегмент `PolylineObject` для Chamfer).

- [x] **"Перенести властивості" (`Match Properties`):**
    - **Ключові технічні завдання:** Створити команду, що дозволяє користувачу вибрати вихідний об'єкт, а потім застосувати його властивості (шар, колір, товщина лінії, стиль тощо) до одного або кількох цільових об'єктів.

## 2.3. Покращення UI/UX та Документація

- [x] **Динамічний курсор:** Змінювати вигляд курсору залежно від поточної дії.
- [x] **"Гумові" лінії та попередній перегляд:** Показувати в реальному часі, як виглядатиме результат.
- [x] **Активація кнопок на панелі:** Підключити кнопки на панелі "Модифікація" до нових команд.
- [x] **Створити та підтримувати специфікацію панелі "Властивості":** Розробити формальний опис вмісту та поведінки панелі властивостей для кожного типу об'єкта в окремому файлі `PROPERTIES_PANEL_SPEC.md`.

- [x] **Технічний рефакторинг іконок:**
    - **Завдання:** Замінити всі поточні SVG-іконки, вбудовані в HTML, на звичайні графічні файли (напр., PNG або WEBP).
    - **Обґрунтування:** Спрощення процесу оновлення іконок, потенційне покращення продуктивності рендерингу на дуже слабких системах, відокремлення графічних ассетів від коду розмітки.
    - **План:**
        1. Згенерувати або підготувати всі необхідні іконки у форматі PNG/WEBP.
        2. Створити директорію для ассетів (напр., `/assets/icons/`).
        3. Замінити всі теги `<svg>` в HTML-файлах панелей на теги `<img>` з відповідними шляхами.
        4. Оновити CSS для правильного стилізування кнопок з новими іконками.